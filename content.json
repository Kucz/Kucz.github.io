{"meta":{"title":"é–ƒé–ƒæ˜ŸèŒ«Â°å¤œç©ºã€ƒåšå®¢","subtitle":"æ—¥æ—¥è¡Œï¼Œä¸æ€•åƒä¸‡é‡Œï¼›å¸¸å¸¸åšï¼Œä¸æ€•åƒä¸‡äº‹ã€‚â€”â€”ã€Šæ ¼è¨€è”ç’§Â·å¤„äº‹ã€‹","description":"è°ä¸ä¼šä¼‘æ¯ï¼Œè°å°±ä¸ä¼šå·¥ä½œã€‚â€”â€”åˆ—å®","author":"é–ƒé–ƒæ˜ŸèŒ«Â°å¤œç©ºã€ƒ","url":"http://yoursite.com"},"pages":[{"title":"å…³äº","date":"2016-04-20T20:48:33.000Z","updated":"2018-07-11T02:26:53.213Z","comments":false,"path":"about/index.html","permalink":"http://yoursite.com/about/index.html","excerpt":"","text":"è‡ªæˆ‘ä»‹ç»æ–°äººä¸€æšï¼Œå¤šå¤šå…³ç…§&nbsp;&nbsp;&nbsp;&nbsp;æ–°äººä¸€æšï¼Œå¤šå¤šå…³ç…§&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ–°äººä¸€æšï¼Œå¤šå¤šå…³ç…§&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;é‡è¦çš„äº‹æƒ…è¯´ä¸‰é! å…¶ä»–èµ„æ–™ä»¥åè¡¥å……ğŸ˜Š"},{"title":"åˆ†ç±»","date":"2018-01-04T16:00:00.000Z","updated":"2018-07-11T01:27:20.451Z","comments":false,"path":"categories/index.html","permalink":"http://yoursite.com/categories/index.html","excerpt":"","text":""},{"title":"æ ‡ç­¾","date":"2018-01-04T16:00:00.000Z","updated":"2018-07-11T01:27:14.787Z","comments":false,"path":"tags/index.html","permalink":"http://yoursite.com/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"MVVM ä¸ ReactiveCocoa","slug":"MVVM-and-RAC","date":"2018-07-10T05:46:58.000Z","updated":"2018-07-10T08:45:22.574Z","comments":true,"path":"2018/07/10/MVVM-and-RAC/","link":"","permalink":"http://yoursite.com/2018/07/10/MVVM-and-RAC/","excerpt":"","text":"MVVMæ¨¡å¼ä¸RAC MVVM æ˜¯ MVC æ¨¡å¼çš„ä¸€ç§æ¼”è¿›ï¼Œå®ƒä¸»è¦è§£å†³äº† ViewController è¿‡äºè‡ƒè‚¿å¸¦æ¥çš„ä¸æ˜“ç»´æŠ¤å’Œæµ‹è¯•çš„é—®é¢˜ã€‚å…¶ä¸­ ViewModel çš„ä¸»è¦èŒ è´£æ˜¯å¤„ç†ä¸šåŠ¡é€»è¾‘å¹¶æä¾› View æ‰€éœ€çš„æ•°æ®ï¼Œè¿™æ · VC å°±ä¸ç”¨å…³å¿ƒä¸šåŠ¡ï¼Œè‡ªç„¶ä¹Ÿå°±ç˜¦äº†ä¸‹æ¥ã€‚ViewModel åªå…³å¿ƒä¸šåŠ¡æ•°æ®ä¸å…³å¿ƒ Viewï¼Œæ‰€ä»¥ä¸ä¼šä¸ View äº§ç”Ÿè€¦åˆï¼Œä¹Ÿå°±æ›´æ–¹ä¾¿è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚ View æ˜¯ä¸€ä¸ªå£³ï¼Œå®ƒæ‰€å‘ˆç°çš„å†…å®¹éƒ½éœ€è¦ç”± ViewModel æ¥æä¾›ï¼Œè€Œ View åˆä¸ä¸ ViewModel ç›´æ¥æ²Ÿé€šï¼Œè¿™æ—¶å°±éœ€è¦ ViewController æ¥åšä¸­é—´çš„åè°ƒè€…ã€‚ViewController æŒæœ‰ Viewå’Œ ViewModelï¼Œå½“ VCåˆå§‹åŒ–æ—¶ï¼Œä¼šè®© ViewModel å»å–æ•°æ®ï¼Œç®€å•æ¥è¯´å°±æ˜¯è°ƒç”¨ VM çš„æŸä¸ªè·å–æ•°æ®çš„æ–¹æ³•ã€‚ ä½¿ç”¨ MVVM æœ€èˆ’æœçš„å§¿åŠ¿æ˜¯æ­é… ReactiveCocoaã€‚ä¸è¿‡å®ƒçš„é—®é¢˜åœ¨äºå­¦ä¹ æˆæœ¬å’Œç»´æŠ¤æˆæœ¬æ¯”è¾ƒé«˜ï¼Œåœ¨å°å›¢é˜Ÿä¸­æˆ–è®¸è¿˜å¯ä»¥å°è¯•ï¼Œå½“å¼€å‘äººå‘˜æ•°é‡è¾ƒå¤šæ—¶å°±å¾ˆéš¾æ¨èµ·æ¥äº†ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä»Šå¤©è¦è®²çš„ä¸»é¢˜ï¼šå¦‚ä½•ä¸å€ŸåŠ© ReactiveCocoa æ¥å®ç° MVVMã€‚ å…ˆä»æ•°æ®çš„è·å–å¼€å§‹è¯´èµ·å§ã€‚åœ¨ ReactiveCocoa é‡Œæœ‰ä¸€ä¸ªç±»å«ã€ŒRACCommandã€ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯æ‰§è¡ŒæŸä¸ªä¼šæ”¹å˜æ•°æ®çš„æ“ä½œï¼Œç„¶åæä¾›è·å–æ•°æ®çš„æ–¹æ³•ï¼Œè·Ÿæˆ‘ä»¬æƒ³è¦è¾¾åˆ°çš„ç›®çš„å¾ˆåƒï¼Œæ‰€ä»¥å¯ä»¥å€Ÿé‰´è¿™ä¸ªæ€è·¯ï¼Œå†™ä¸€ä¸ªç®€å•çš„ Commandã€‚ 12345678910111213141516171819202122232425262728293031typedef void(^MGJCommandCompletionBlock)(id error, id content);// 1typedef void(^MGJCommandConsumeBlock)(id input, MGJCommandCompletionBlock completionHandler);// 2typedef void(^MGJCommandCancelBlock)();@interface MGJCommandResult : NSObject// 3@property (nonatomic) NSError *error;// 4@property (nonatomic) id content;@end@interface MGJCommand : NSObject// 5@property (nonatomic, readonly) BOOL executing;// 6@property (nonatomic, readonly) MGJCommandResult *result;- (instancetype)initWithConsumeHandler:(MGJCommandConsumeBlock )consumeHandler;// 7- (instancetype)initWithConsumeHandler:(MGJCommandConsumeBlock )consumeHandler cancelHandler:(MGJCommandCancelBlock )cancelHandler;// 8- (void)execute:(id)input;// 9- (void)cancel;@end 1.inputæ˜¯å¤–éƒ¨ä¼ è¿‡æ¥çš„å€¼ï¼Œæ¯”å¦‚ user_idï¼Œå½“æ‹¿åˆ°æ•°æ®åï¼Œè°ƒç”¨ä¸‹ completionHandlerï¼Œè¿™æ · result å±æ€§å°±ä¼šå˜åŒ–2.æœ‰äº›æ“ä½œï¼Œå¦‚ http è¯·æ±‚ï¼Œéœ€è¦æ‰‹åŠ¨å–æ¶ˆ3.å•ç‹¬æŠŠ errorä½œä¸ºä¸€ä¸ªå±æ€§æ”¾å‡ºæ¥ï¼Œæ˜¯å› ä¸ºå¾ˆå¤šæ•°æ®è¯·æ±‚æ“ä½œéƒ½å¯èƒ½å‡ºé”™ï¼Œå½“å‡ºé”™åï¼Œåªéœ€æ”¹å˜è¿™ä¸ª error å±æ€§å³å¯ã€‚4.content å­˜æ”¾äº†è¿™ä¸ª Command çš„æ•°æ®å¤„ç†ç»“æœã€‚5.æ ‡è¯†äº†è¿™ä¸ª Command ç›®å‰çš„è¿è¡ŒçŠ¶æ€ï¼Œæ¯”å¦‚å¯ä»¥æ ¹æ®è¿™ä¸ªçŠ¶æ€æ¥æ˜¾ç¤º loadingã€‚6.æ¯æ¬¡ Command æ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡åï¼Œresult éƒ½ä¼šæ”¹å˜ï¼Œå¤–éƒ¨å¯ä»¥ KVO è¿™ä¸ª resultï¼Œç„¶åå°±å¯ä»¥å®æ—¶è·å–æœ€æ–°çš„ç»“æœäº†ã€‚7.Command çš„æ‰§è¡Œé€»è¾‘ï¼Œå¦‚æœå®ç°äº† cancelHandler çš„è¯ï¼Œå¤–éƒ¨è°ƒç”¨ cancelï¼Œè¿™ä¸ª Handler å°±ä¼šè¢«è§¦å‘ã€‚8.å¤–éƒ¨å¯ä»¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ¥è§¦å‘ Command çš„æ‰§è¡Œï¼ŒåŒæ—¶å¯ä»¥ä¼ ä¸€ä¸ªå‚æ•°è¿›æ¥ã€‚9.å¤–éƒ¨å¯ä»¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ¥å–æ¶ˆ Command çš„æ‰§è¡Œã€‚ å®ç°èµ·æ¥ä¹Ÿè›®ç®€å•çš„ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº†ã€‚ç”¨èµ·æ¥å¤§æ¦‚æ˜¯è¿™æ ·ï¼š 1234567891011// SomeViewModel.m@weakify(self);self.followCommand = [[MGJCommand alloc] initWithConsumeHandler:^(id input, MGJCommandCompletionBlock completionHandler) &#123; @strongify(self); [FollowRequest getFollowList:(NSDictionary *)input success:^(NSArray *users) &#123; self.usersToFollow = users; completionHandler(nil, kFollowExpertSearchSucceedSignal); &#125; failure:^(StatusEntity *error) &#123; completionHandler(error, nil); &#125;];&#125;]; åœ¨ ViewController é‡Œçš„ç”¨æ³•å¤§æ¦‚åƒè¿™æ ·1234567// SomeViewController.m- (void)didTapFollowButton:(UIButton *)button&#123; // æ ¹æ® button æ‰¾åˆ° userID [self.viewModel.followCommand execute:userID];&#125; å°±æ˜¯è¿™æ ·ï¼ŒVC æœ¬èº«ä¸å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œéƒ½äº¤ç»™ ViewModel å»å¤„ç†ï¼Œè€Œè¿™äº›æ•°æ®è¯·æ±‚çš„ç»“æœå¤„ç†åˆæœ‰ä¸åŒçš„å¤„ç†æ–¹å¼ã€‚ Delegateå½“ ViewModel æ‹¿åˆ°æ•°æ®åï¼Œå¯ä»¥æŠŠç»“æœä»¥ Delegate çš„æ–¹å¼é€šçŸ¥ VCï¼Œå°±åƒè¿™æ ·1234567// SomeViewController.m- (void)didFollowUserWithResult:(id)result&#123; self.followButton.enabled = YES; [self.followButton doSomeAnimation];&#125; è¿™æ ·åšçš„å¥½å¤„æ˜¯æ¯”è¾ƒç¬¦åˆè‹¹æœæ—¢æœ‰çš„è®¾è®¡æ¨¡å¼ï¼Œè€Œä¸”ä¹Ÿå¯ä»¥é€šè¿‡æŸ¥çœ‹ Delegate åè®®æ¥çŸ¥é“ VM æš´éœ²äº†å“ªäº›æ¥å£ä¾›å¤–éƒ¨ä½¿ç”¨ã€‚ ä¸è¿‡è¿™ç§æ–¹æ³•å°‘äº†ç‚¹çµæ´»æ€§ï¼Œæ¯”å¦‚éœ€è¦è”åˆå¤šä¸ªå±æ€§çš„å˜åŒ–æ¥åšä¸€äº›äº‹æƒ…æ—¶ï¼Œå¤„ç†èµ·æ¥å°±ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œè¿™ä¹Ÿæ˜¯ RAC å¼ºå¤§çš„åœ°æ–¹ã€‚ KVORAC æ˜¯åŸºäº KVO æ„å»ºçš„ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ç”¨ KVO æ¥è®© VC è·å– VM çš„å˜åŒ–ã€‚ä½†æˆ‘ä»¬éƒ½çŸ¥é“ KVO çš„æ§½ç‚¹æ¯”è¾ƒå¤šï¼Œæ¯”å¦‚ä½¿ç”¨èµ·æ¥ä¸æ–¹ä¾¿ï¼Œç”¨å®Œè¿˜è¦è®°å¾—ç§»é™¤ç­‰ã€‚è¿™é‡Œå¯ä»¥ä½¿ç”¨ Facebook å¼€æºçš„ KVOControllerï¼Œå®ƒæ¯”è¾ƒå¥½çš„å¤„ç†äº† KVO å­˜åœ¨çš„ä¸€äº›é—®é¢˜ï¼ŒåŒæ—¶åˆèƒ½å‘æŒ¥ KVO å¸¦æ¥çš„ä¾¿æ·æ€§ã€‚æœ‰äº†å®ƒæˆ‘ä»¬å°±èƒ½åœ¨ä¸€ä¸ªåœ°æ–¹æŠŠ VM çš„æ›´æ–°å¤„ç†æ‰äº†123456789- (void)handleViewModelUpdate&#123; [self.KVOController observe:self.viewModel keyPath:@&quot;followCommand.result&quot; options:NSKeyValueObservingOptionInitial|NSKeyValueObservingOptionNew block:^(id observer, id target, NSDictionary *change) &#123; id newValue = change[NSKeyValueChangeNewKey]; // doSomething with the newValue &#125;]; // å¯¹ VM å…¶ä»– keyPath çš„å¤„ç†ä¹Ÿéƒ½å¯ä»¥æ”¾åˆ°è¿™é‡Œ&#125; å¦‚æœè§‰å¾—è¿™æ ·çš„å†™æ³•è¿˜æ˜¯å¤ªéº»çƒ¦ï¼Œå¯ä»¥åšä¸€å±‚ç®€å•çš„å°è£…ï¼Œä½¿ç”¨èµ·æ¥å°±åƒè¿™æ · 123456- (void)handleViewModelUpdate&#123; [self observe:self.viewModel keyPath:@&quot;followCommand.result&quot; block: ^(id newValue)&#123; // use newValue to update view &#125;];&#125; æ˜¯ä¸æ˜¯ä¼šå¥½ä¸€ç‚¹ï¼Œä½¿ç”¨ KVO æ¯” Delegate å¥½çš„ä¸€ç‚¹æ˜¯ä¸ç”¨å†é¢å¤–å£°æ˜åè®®å’Œæ–¹æ³•ï¼Œè€Œä¸”æ”¯æŒ blockï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿä¼šæ–¹ä¾¿äº›ã€‚å¯¹äºåƒ error è¿™æ ·å¾ˆå¤šæ“ä½œéƒ½ä¼šäº§ç”ŸåŒæ ·ç»“æœçš„åœºæ™¯ï¼Œå¯ä»¥å•ç‹¬æ‹¿å‡ºæ¥ï¼Œä½œä¸º ViewModel çš„ä¸€ä¸ªå±æ€§ï¼Œä½¿ç”¨æ—¶ï¼Œç›´æ¥ KVO è¿™ä¸ªå±æ€§å³å¯ã€‚ ç»†èŠ‚å¤„ç†å¦‚æœä¸æ¶‰åŠåˆ° TableView ç­‰ä¼šå‡ºç°å¤ç”¨åœºæ™¯çš„åœ°æ–¹ï¼ŒMVVM ä½¿ç”¨èµ·æ¥è¿˜æ˜¯æ¯”è¾ƒæ–¹ä¾¿çš„ã€‚å¦‚æœæœ‰äº† TableViewï¼Œåˆè¦åšä¸€äº›é¢å¤–çš„å¤„ç†ã€‚ ä¸€èˆ¬æ¥è¯´ï¼ŒVC å¯ä»¥å¸¦ä¸€ä¸ª VMï¼Œé‚£å¦‚æœå‡ºç° Cell æ—¶æ€ä¹ˆåŠï¼ŒCell é‡ŒåˆåŒ…å«äº†æŒ‰é’®ï¼ŒæŒ‰é’®åˆéœ€è¦æ•°æ®è¯·æ±‚åˆæ€ä¹ˆå¤„ç†ï¼Ÿè¿™äº›éƒ½æ˜¯æ¯”è¾ƒå¸¸è§çš„åœºæ™¯ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ MVVM æ¥è§£å†³ã€‚ æˆ‘ä»¬çŸ¥é“ VM çš„èŒè´£æ˜¯ä¸º View æä¾›æ•°æ®æ”¯æŒï¼ŒCell ä¹Ÿæ˜¯ä¸€ä¸ª Viewï¼Œé‚£ä¹ˆä¸º Cell é…å¤‡ä¸€ä¸ª VM ä¸å°±å¯ä»¥äº†ä¹ˆã€‚ è¿™æ ·çš„è¯ï¼ŒVC çš„ VM éœ€è¦åŒ…å«ä¸€ä¸ªæ•°ç»„ï¼Œé‡Œé¢çš„å…ƒç´ æ˜¯ CellVMï¼Œä½¿ç”¨èµ·æ¥å°±åƒè¿™æ · 1234567891011121314// SomeViewController.m- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath&#123; UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:@&quot;Cell&quot; forIndexPath:indexPath]; cell.viewModel = self.viewModel.cellViewModels[indexPath.row]; // cell å¯èƒ½ä¼šç”¨åˆ° cellVM é‡Œçš„ Commandï¼Œæ‰€ä»¥åœ¨è¿™é‡Œå¤„ç† command çš„æ‰§è¡Œç»“æœ [self observe:cell keyPath:@&quot;likeCommand.result&quot; block: ^(id newValue)&#123; // update cell after like &#125;]; return cell&#125; å½“ç„¶ä»…ä»…å¦‚æ­¤æ˜¯ä¸å¤Ÿçš„ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾ä¸ªæ°å½“çš„æ—¶æœºæŠŠ KVO ç§»é™¤ï¼Œé¿å…å¤šæ¬¡ç›‘å¬ã€‚UITableViewDelegate é‡Œçš„è¿™ä¸ªæ–¹æ³•å°±å¾ˆé€‚åˆã€‚ 123456// SomeViewController.m- (void)tableView:(UITableView *)tableView didEndDisplayingCell:(UITableViewCell *)cell forRowAtIndexPath:(NSIndexPath *)indexPath&#123; [self unobserve:cell keyPath:@&quot;likeCommand.result&quot;];&#125; ä¸è¿‡è¿™é‡Œä¹Ÿè¦è®²ç©¶ä¸€ä¸ªå¹³è¡¡ï¼Œå¦‚æœ Cell çš„ç±»å‹æ¯”è¾ƒå¤šï¼Œä¸”æ¶‰åŠ Command çš„åœ°æ–¹ä¸å¤šï¼Œåªæ˜¯åšå‘ˆç°æ–¹é¢çš„å·¥ä½œï¼Œç›´æ¥ä½¿ç”¨ Entity ä¼šæ›´æ–¹ä¾¿ã€‚ Tips ViewController å°½é‡ä¸æ¶‰åŠä¸šåŠ¡é€»è¾‘ï¼Œè®© ViewModel å»åšè¿™äº›äº‹æƒ…ã€‚ ViewController åªæ˜¯ä¸€ä¸ªä¸­é—´äººï¼Œæ¥æ”¶ View çš„äº‹ä»¶ã€è°ƒç”¨ ViewModel çš„æ–¹æ³•ã€å“åº” ViewModel çš„å˜åŒ–ã€‚ ViewModel ä¸èƒ½åŒ…å« Viewï¼Œä¸ç„¶å°±è·Ÿ View äº§ç”Ÿäº†è€¦åˆï¼Œä¸æ–¹ä¾¿å¤ç”¨å’Œæµ‹è¯•ã€‚ ViewModel ä¹‹é—´å¯ä»¥æœ‰ä¾èµ–ã€‚ ViewModel é¿å…è¿‡äºè‡ƒè‚¿ï¼Œä¸ç„¶ç»´æŠ¤èµ·æ¥ä¹Ÿæ˜¯ä¸ªé—®é¢˜ã€‚MVVM å¹¶ä¸å¤æ‚ï¼Œè·Ÿ MVC ä¹Ÿæ˜¯å…¼å®¹çš„ï¼Œåªæ˜¯å¤šäº†ä¸€ä¸ª ViewModel å±‚ï¼Œä½†å°±æ˜¯è¿™ä¹ˆä¸€ä¸ªå°æ”¹åŠ¨ï¼Œå°±èƒ½è®©ä»£ç å˜å¾—æ›´åŠ å®¹æ˜“é˜…è¯»å’Œç»´æŠ¤ï¼Œä¸å¦¨è¯•ä¸€ä¸‹å§ã€‚ ä»¥ä¸Šä¸ºè®°å½•è´´","categories":[],"tags":[{"name":"iOS","slug":"iOS","permalink":"http://yoursite.com/tags/iOS/"}]}]}